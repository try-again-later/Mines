(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(i){if(i.ep)return;i.ep=!0;const l=t(i);fetch(i.href,l)}})();const v={fps:30};class M{element;fps;startTime=new Date(0);stopTime=new Date(0);shouldStop=!0;stopped=Promise.resolve();constructor(e,t=v){this.element=e,this.element.textContent="0:000",this.fps=t.fps}setElementValue(e){const t=Math.floor(e/1e3),s=`${e%1e3}`.padStart(3,"0");this.element.textContent=`${t}:${s}`}async start(){this.startTime=new Date,this.shouldStop=!1,await this.stopped,this.stopped=new Promise(e=>{let t=0;const s=i=>{if(i-t>1e3/this.fps){t=i;const l=new Date().getTime()-this.startTime.getTime();this.setElementValue(l)}this.shouldStop?e():requestAnimationFrame(s)};requestAnimationFrame(s)})}async stop(){this.shouldStop=!0,this.stopTime=new Date,await this.stopped,this.setElementValue(this.finalMillisElapsed())}async reset(){await this.stop(),this.element.textContent="0:000"}finalMillisElapsed(){return this.stopTime.getTime()-this.startTime.getTime()}}function g(r,e){if(r==4)return`mine-neighbors-${e.neighborMineCount}`;switch(r){case 0:return"mine";case 1:return"mine-explosion";case 2:return"question-mark";case 3:return"flag-mark";default:throw r}}function p(r){const e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"svg");t.classList.add("sprite");const s=document.createElementNS(e,"use");return s.setAttribute("href",`sprites.svg#${r}`),t.appendChild(s),t}var c=(r=>(r[r.Flag=0]="Flag",r[r.QuestionMark=1]="QuestionMark",r))(c||{});class b{constructor(e,t){this._x=e,this._y=t,this._element=document.createElement("div"),this._element.classList.add("cell"),this._element.dataset.x=e.toString(),this._element.dataset.y=t.toString(),this.contentElement=document.createElement("div"),this.contentElement.classList.add("cell-content"),this._element.appendChild(this.contentElement),this.coverElement=document.createElement("div"),this.coverElement.classList.add("cell-cover"),this.contentElement.appendChild(this.coverElement),this.spriteElement=null}neighborMineCount=0;hasMine=!1;_revealed=!1;_onReveal=()=>{};_mark=null;_onMarkChange=()=>{};_element;contentElement;coverElement;spriteElement;get x(){return this._x}get y(){return this._y}get element(){return this._element}get revealed(){return this._revealed}get mark(){return this._mark}set onReveal(e){this._onReveal=e}set onMarkChange(e){this._onMarkChange=e}addMark(e){switch(this._mark!=e&&this._onMarkChange(this,e),this._mark=e,this.spriteElement?.remove(),e){case 0:{const t=g(3);this.coverElement.appendChild(p(t)),this.spriteElement=this.coverElement.lastElementChild}break;case 1:{const t=g(2);this.coverElement.appendChild(p(t)),this.spriteElement=this.coverElement.lastElementChild}break}}hasMark(){return this._mark!=null}removeMark(){this._mark!=null&&this._onMarkChange(this,null),this._mark=null,this.spriteElement?.remove()}reveal(){this._onReveal(this),this._revealed=!0,this._mark=null}refreshSprite(){if(this.spriteElement?.remove(),this.hasMine){const e=g(0);this.contentElement.appendChild(p(e)),this.spriteElement=this.contentElement.lastElementChild}else if(this.neighborMineCount>0){const e=g(4,{neighborMineCount:this.neighborMineCount});this.contentElement.appendChild(p(e)),this.spriteElement=this.contentElement.lastElementChild}}explode(){if(this.hasMine){this.spriteElement?.remove();const e=g(1);this.contentElement.appendChild(p(e)),this.spriteElement=this.contentElement.lastElementChild}}animateReveal(e=0){this.element.classList.add("revealed"),this.coverElement.animate([{opacity:1,transform:"none"},{offset:.35,opacity:1,transform:"translate(0, -10%)"},{opacity:0,transform:"translate(0, -20%)"}],{fill:"forwards",duration:150,delay:e})}reset(){for(const e of this.coverElement.getAnimations())e.finish();this._revealed&&this.coverElement.animate([{opacity:0,transform:"none"},{opacity:1,transform:"none"}],{fill:"forwards",duration:0}),this.element.classList.remove("revealed"),this.spriteElement?.remove(),this._revealed=!1,this._mark=null,this.hasMine=!1,this.neighborMineCount=0}}var f=(r=>(r[r.Left=0]="Left",r[r.Right=1]="Right",r[r.Both=2]="Both",r))(f||{});const y=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];class L{constructor(e,t){this.width=e,this.height=t,this.element=document.getElementById("game-field"),this.revealedCellCount=0,this.cells=[];for(let n=0;n<this.height;n+=1)for(let h=0;h<this.width;h+=1){const a=new b(h,n);this.cells.push(a),this.element.appendChild(a.element)}const s=[],i=(n,h)=>{const a=this.getCell(n,h);if(!a.hasMark()){a.revealed||(a.element.classList.add("active"),s.push(a));for(const d of this.getNeighbors(a))!d.revealed&&d.mark==null&&(d.element.classList.add("active"),s.push(d))}},l=()=>{for(const n of s)n.element.classList.remove("active");s.length=0};let o=!1,m=!1;this.element.addEventListener("mousedown",n=>{if(n.preventDefault(),n.button==0&&(o=!0),n.button==2&&(m=!0),o&&m&&n.target instanceof HTMLElement&&n.target.classList.contains("cell")){const h=Number.parseInt(n.target.dataset.x),a=Number.parseInt(n.target.dataset.y);i(h,a)}}),this.element.addEventListener("mouseup",n=>{if(n.button!=0&&n.button!=2)return;l();let h=null;if(o&&m?h=f.Both:o?h=f.Left:m&&(h=f.Right),h!=null&&n.target instanceof HTMLElement&&n.target.classList.contains("cell")){const a=Number.parseInt(n.target.dataset.x),d=Number.parseInt(n.target.dataset.y),u=this.getCell(a,d);this.onCellClick(u,h)}o=!1,m=!1}),this.element.addEventListener("mouseover",n=>{if(o&&m&&n.target instanceof HTMLElement&&n.target.classList.contains("cell")){l();const h=Number.parseInt(n.target.dataset.x),a=Number.parseInt(n.target.dataset.y);i(h,a)}}),this.element.addEventListener("mouseleave",n=>{n.target==this.element&&(l(),o=!1,m=!1)}),this.element.addEventListener("contextmenu",n=>{n.preventDefault()})}element;revealedCellCount;cells;onCellClick=()=>{};set onCellMarkChange(e){for(const t of this.cells)t.onMarkChange=e}set onCellReveal(e){for(const t of this.cells)t.onReveal=e}getCell(e,t){const s=this.cells[t*this.width+e];if(s==null)throw new Error("Cell coordinatesa are out of bounds.");return s}cellIndex(e){return e.y*this.width+e.x}*getNeighbors(e){for(const[t,s]of y)e.x+t<0||e.x+t>=this.width||e.y+s<0||e.y+s>=this.height||(yield this.getCell(e.x+t,e.y+s))}fillWithMines(e){if(e>this.width*this.height)throw new Error("Too many mines for the current game field size.");const t=[];for(let s=0;s<this.width*this.height;s+=1)t.push(s);for(let s=0;s<e;s+=1){let i=Math.floor(Math.random()*t.length);const l=this.cells[t[i]];l.hasMine=!0;for(const o of this.getNeighbors(l))o.neighborMineCount+=1;t[i]=t[t.length-1],t.pop()}for(const s of this.cells)s.refreshSprite()}reveal(e,t){const s=this.getCell(e,t);if(!s.revealed)if(s.hasMine||s.neighborMineCount>0)s.reveal(),s.animateReveal(),this.revealedCellCount+=1;else{const i=new Set,l=new Map,o=[s];l.set(this.cellIndex(s),0);let m=0;for(;o.length>0;){const n=o.length;for(let h=0;h<n;h+=1){const a=o.shift();a.reveal(),this.revealedCellCount+=1;const d=l.get(this.cellIndex(a));if(a.animateReveal(Math.min(d,100)*15),a.neighborMineCount==0)for(const u of this.getNeighbors(a)){const E=this.cellIndex(u);!i.has(E)&&!u.revealed&&(i.add(E),l.set(E,m+1),o.push(u))}}m+=1}}}revealAll(){for(const e of this.cells)e.revealed||e.animateReveal(),e.reveal();this.revealedCellCount=this.width*this.height}reset(){for(const e of this.cells)e.reset();this.revealedCellCount=0}}const C="GAME_STATE_START",_="GAME_STATE_IN_PROGRESS",w="GAME_STATE_WIN",k="GAME_STATE_LOSE";class T{constructor(){this.state=C,this.width=16,this.height=16,this.mineCount=30;const e=document.getElementById("difficulty-selection");let t=!1;document.getElementById("difficulty-selection-button").addEventListener("click",()=>{t?(e.style.display="none",t=!1):(e.style.display="block",t=!0)}),this.minesLeftElement=document.getElementById("mines-left"),this.setMinesLeft(this.mineCount);const s=document.getElementById("game-timer");this.timer=new M(s),this.gameField=new L(this.width,this.height),this.gameField.fillWithMines(this.mineCount),this.gameField.onCellMarkChange=(i,l)=>{i.mark===c.Flag&&this.setMinesLeft(this.minesLeft+1),l===c.Flag&&this.setMinesLeft(this.minesLeft-1)},this.gameField.onCellReveal=i=>{i.mark===c.Flag&&!i.hasMine&&this.setMinesLeft(this.minesLeft+1),i.mark===null&&i.hasMine&&this.setMinesLeft(this.minesLeft-1)},this.gameField.onCellClick=(i,l)=>{switch(l){case f.Left:this.leftMouseButtonClick(i);break;case f.Right:this.rightMouseButtonClick(i);break;case f.Both:this.bothMouseButtonsClick(i);break}}}setMinesLeft(e){this.minesLeft=e,this.minesLeftElement.textContent=e}reveal(e){if(this.state===C&&(this.timer.start(),this.state=_),e.hasMine){this.state=k,this.timer.stop(),this.gameField.revealAll();for(const t of this.gameField.cells)t.explode()}else{this.gameField.reveal(e.x,e.y);const t=this.gameField.width*this.gameField.height;this.gameField.revealedCellCount+this.mineCount===t&&(this.state=w,this.timer.stop(),this.gameField.revealAll())}}leftMouseButtonClick(e){if(!e.revealed){if(e.hasMark())return;this.reveal(e)}}rightMouseButtonClick(e){e.revealed||(e.hasMark()?e.mark===c.Flag?e.addMark(c.QuestionMark):e.removeMark():e.addMark(c.Flag))}bothMouseButtonsClick(e){if(!e.revealed)this.leftMouseButtonClick(e);else{let t=0;for(const s of this.gameField.getNeighbors(e))s.mark===c.Flag&&(t+=1);if(t===e.neighborMineCount)for(const s of this.gameField.getNeighbors(e))!s.revealed&&s.mark!==c.Flag&&this.reveal(s)}}reset(){this.gameField.reset(),this.gameField.fillWithMines(this.mineCount),this.timer.reset(),this.state=C,this.setMinesLeft(this.mineCount)}}const S=new T,x=document.getElementById("new-game-button");x.addEventListener("click",()=>{S.reset()});
