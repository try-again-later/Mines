(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(i){if(i.ep)return;i.ep=!0;const l=t(i);fetch(i.href,l)}})();const v={fps:30};class M{element;fps;startTime=new Date(0);stopTime=new Date(0);shouldStop=!0;stopped=Promise.resolve();constructor(e,t=v){this.element=e,this.element.textContent="0:000",this.fps=t.fps}setElementValue(e){const t=Math.floor(e/1e3),s=`${e%1e3}`.padStart(3,"0");this.element.textContent=`${t}:${s}`}async start(){this.startTime=new Date,this.shouldStop=!1,await this.stopped,this.stopped=new Promise(e=>{let t=0;const s=i=>{if(i-t>1e3/this.fps){t=i;const l=new Date().getTime()-this.startTime.getTime();this.setElementValue(l)}this.shouldStop?e():requestAnimationFrame(s)};requestAnimationFrame(s)})}async stop(){this.shouldStop=!0,this.stopTime=new Date,await this.stopped,this.setElementValue(this.finalMillisElapsed())}async reset(){await this.stop(),this.element.textContent="0:000"}finalMillisElapsed(){return this.stopTime.getTime()-this.startTime.getTime()}}const L="mine",b="mine-explosion",y="question-mark",T="flag-mark",w={1:"mine-neighbors-1",2:"mine-neighbors-2",3:"mine-neighbors-3",4:"mine-neighbors-4",5:"mine-neighbors-5",6:"mine-neighbors-6",7:"mine-neighbors-7",8:"mine-neighbors-8"};function g(h){const e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"svg");t.classList.add("sprite");const s=document.createElementNS(e,"use");return s.setAttribute("href",`sprites.svg#${h}`),t.appendChild(s),t}const d="CELL_FLAG_MARK",C="CELL_QUESTION_MARK";class k{constructor(e,t){this.x=e,this.y=t,this.revealed=!1,this.onReveal=s=>{},this.mark=null,this.onMarkChange=(s,i)=>{},this.neighborMineCount=0,this.hasMine=!1,this.element=document.createElement("div"),this.element.classList.add("cell"),this.element.dataset.x=e,this.element.dataset.y=t,this.contentElement=document.createElement("div"),this.contentElement.classList.add("cell-content"),this.element.appendChild(this.contentElement),this.coverElement=document.createElement("div"),this.coverElement.classList.add("cell-cover"),this.contentElement.appendChild(this.coverElement),this.spriteElement=null}addMark(e){switch(this.mark!==e&&this.onMarkChange(this,e),this.mark=e,this.spriteElement?.remove(),e){case d:this.coverElement.appendChild(g(T)),this.spriteElement=this.coverElement.lastElementChild;break;case C:this.coverElement.appendChild(g(y)),this.spriteElement=this.coverElement.lastElementChild;break}}hasMark(){return this.mark!==null}removeMark(){this.mark!==null&&this.onMarkChange(this,null),this.mark=null,this.spriteElement?.remove()}reveal(){this.onReveal(this),this.revealed=!0,this.mark=null}addSprite(){if(this.spriteElement?.remove(),this.hasMine)this.contentElement.appendChild(g(L)),this.spriteElement=this.contentElement.lastElementChild;else if(this.neighborMineCount>0){const e=g(w[this.neighborMineCount]);this.contentElement.appendChild(e),this.spriteElement=this.contentElement.lastElementChild}}animateReveal(e=0){this.element.classList.add("revealed"),this.coverElement.animate([{opacity:1,transform:"none"},{offset:.35,opacity:1,transform:"translate(0, -10%)"},{opacity:0,transform:"translate(0, -20%)"}],{fill:"forwards",duration:150,delay:e})}reset(){for(const e of this.coverElement.getAnimations())e.finish();this.revealed&&this.coverElement.animate([{opacity:0,transform:"none"},{opacity:1,transform:"none"}],{fill:"forwards",duration:0}),this.element.classList.remove("revealed"),this.spriteElement?.remove(),this.revealed=!1,this.mark=null,this.hasMine=!1,this.neighborMineCount=0}}var f=(h=>(h[h.Left=0]="Left",h[h.Right=1]="Right",h[h.Both=2]="Both",h))(f||{});const S=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];class I{constructor(e,t){this.width=e,this.height=t,this.element=document.getElementById("game-field"),this.revealedCellCount=0,this.cells=[];for(let n=0;n<this.height;n+=1)for(let r=0;r<this.width;r+=1){const o=new k(r,n);this.cells.push(o),this.element.appendChild(o.element)}const s=[],i=(n,r)=>{const o=this.getCell(n,r);if(!o.hasMark()){o.revealed||(o.element.classList.add("active"),s.push(o));for(const c of this.getNeighbors(o))!c.revealed&&c.mark==null&&(c.element.classList.add("active"),s.push(c))}},l=()=>{for(const n of s)n.element.classList.remove("active");s.length=0};let a=!1,m=!1;this.element.addEventListener("mousedown",n=>{if(n.preventDefault(),n.button==0&&(a=!0),n.button==2&&(m=!0),a&&m&&n.target instanceof HTMLElement&&n.target.classList.contains("cell")){const r=Number.parseInt(n.target.dataset.x),o=Number.parseInt(n.target.dataset.y);i(r,o)}}),this.element.addEventListener("mouseup",n=>{if(n.button!=0&&n.button!=2)return;l();let r=null;if(a&&m?r=f.Both:a?r=f.Left:m&&(r=f.Right),r!=null&&n.target instanceof HTMLElement&&n.target.classList.contains("cell")){const o=Number.parseInt(n.target.dataset.x),c=Number.parseInt(n.target.dataset.y),u=this.getCell(o,c);this.onCellClick(u,r)}a=!1,m=!1}),this.element.addEventListener("mouseover",n=>{if(a&&m&&n.target instanceof HTMLElement&&n.target.classList.contains("cell")){l();const r=Number.parseInt(n.target.dataset.x),o=Number.parseInt(n.target.dataset.y);i(r,o)}}),this.element.addEventListener("mouseleave",n=>{n.target==this.element&&(l(),a=!1,m=!1)}),this.element.addEventListener("contextmenu",n=>{n.preventDefault()})}element;revealedCellCount;cells;onCellClick=()=>{};set onCellMarkChange(e){for(const t of this.cells)t.onMarkChange=e}set onCellReveal(e){for(const t of this.cells)t.onReveal=e}getCell(e,t){const s=this.cells[t*this.width+e];if(s==null)throw new Error("Cell coordinatesa are out of bounds.");return s}cellIndex(e){return e.y*this.width+e.x}*getNeighbors(e){for(const[t,s]of S)e.x+t<0||e.x+t>=this.width||e.y+s<0||e.y+s>=this.height||(yield this.getCell(e.x+t,e.y+s))}fillWithMines(e){if(e>this.width*this.height)throw new Error("Too many mines for the current game field size.");const t=[];for(let s=0;s<this.width*this.height;s+=1)t.push(s);for(let s=0;s<e;s+=1){let i=Math.floor(Math.random()*t.length);const l=this.cells[t[i]];l.hasMine=!0;for(const a of this.getNeighbors(l))a.neighborMineCount+=1;t[i]=t[t.length-1],t.pop()}for(const s of this.cells)s.addSprite()}reveal(e,t){const s=this.getCell(e,t);if(!s.revealed)if(s.hasMine||s.neighborMineCount>0)s.reveal(),s.animateReveal(),this.revealedCellCount+=1;else{const i=new Set,l=new Map,a=[s];l.set(this.cellIndex(s),0);let m=0;for(;a.length>0;){const n=a.length;for(let r=0;r<n;r+=1){const o=a.shift();o.reveal(),this.revealedCellCount+=1;const c=l.get(this.cellIndex(o));if(o.animateReveal(Math.min(c,100)*15),o.neighborMineCount==0)for(const u of this.getNeighbors(o)){const E=this.cellIndex(u);!i.has(E)&&!u.revealed&&(i.add(E),l.set(E,m+1),a.push(u))}}m+=1}}}revealAll(){for(const e of this.cells)e.revealed||e.animateReveal(),e.reveal();this.revealedCellCount=this.width*this.height}reset(){for(const e of this.cells)e.reset();this.revealedCellCount=0}}const p="GAME_STATE_START",_="GAME_STATE_IN_PROGRESS",A="GAME_STATE_WIN",R="GAME_STATE_LOSE";class N{constructor(){this.state=p,this.width=16,this.height=16,this.mineCount=30;const e=document.getElementById("difficulty-selection");let t=!1;document.getElementById("difficulty-selection-button").addEventListener("click",()=>{t?(e.style.display="none",t=!1):(e.style.display="block",t=!0)}),this.minesLeftElement=document.getElementById("mines-left"),this.setMinesLeft(this.mineCount);const s=document.getElementById("game-timer");this.timer=new M(s),this.gameField=new I(this.width,this.height),this.gameField.fillWithMines(this.mineCount),this.gameField.onCellMarkChange=(i,l)=>{i.mark===d&&this.setMinesLeft(this.minesLeft+1),l===d&&this.setMinesLeft(this.minesLeft-1)},this.gameField.onCellReveal=i=>{i.mark===d&&!i.hasMine&&this.setMinesLeft(this.minesLeft+1),i.mark===null&&i.hasMine&&this.setMinesLeft(this.minesLeft-1)},this.gameField.onCellClick=(i,l)=>{switch(l){case f.Left:this.leftMouseButtonClick(i);break;case f.Right:this.rightMouseButtonClick(i);break;case f.Both:this.bothMouseButtonsClick(i);break}}}setMinesLeft(e){this.minesLeft=e,this.minesLeftElement.textContent=e}reveal(e){if(this.state===p&&(this.timer.start(),this.state=_),e.hasMine){this.state=R,this.timer.stop(),this.gameField.revealAll();for(const t of this.gameField.cells)t.hasMine&&(t.spriteElement?.remove(),t.contentElement.appendChild(g(b)),t.spriteElement=t.contentElement.lastElementChild)}else{this.gameField.reveal(e.x,e.y);const t=this.gameField.width*this.gameField.height;this.gameField.revealedCellCount+this.mineCount===t&&(this.state=A,this.timer.stop(),this.gameField.revealAll())}}leftMouseButtonClick(e){if(!e.revealed){if(e.hasMark())return;this.reveal(e)}}rightMouseButtonClick(e){e.revealed||(e.hasMark()?e.mark===d?e.addMark(C):e.removeMark():e.addMark(d))}bothMouseButtonsClick(e){if(!e.revealed)this.leftMouseButtonClick(e);else{let t=0;for(const s of this.gameField.getNeighbors(e))s.mark===d&&(t+=1);if(t===e.neighborMineCount)for(const s of this.gameField.getNeighbors(e))!s.revealed&&s.mark!==d&&this.reveal(s)}}reset(){this.gameField.reset(),this.gameField.fillWithMines(this.mineCount),this.timer.reset(),this.state=p,this.setMinesLeft(this.mineCount)}}const x=new N,F=document.getElementById("new-game-button");F.addEventListener("click",()=>{x.reset()});
