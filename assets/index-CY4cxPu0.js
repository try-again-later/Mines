(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function s(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(n){if(n.ep)return;n.ep=!0;const r=s(n);fetch(n.href,r)}})();const v={fps:30};class E{element;fps;startTime=new Date(0);stopTime=new Date(0);shouldStop=!0;stopped=Promise.resolve();constructor(e,s=v){this.element=e,this.element.textContent="0:000",this.fps=s.fps}setElementValue(e){const s=Math.floor(e/1e3),t=`${e%1e3}`.padStart(3,"0");this.element.textContent=`${s}:${t}`}async start(){this.startTime=new Date,this.shouldStop=!1,await this.stopped,this.stopped=new Promise(e=>{let s=0;const t=n=>{if(n-s>1e3/this.fps){s=n;const r=new Date().getTime()-this.startTime.getTime();this.setElementValue(r)}this.shouldStop?e():requestAnimationFrame(t)};requestAnimationFrame(t)})}async stop(){this.shouldStop=!0,this.stopTime=new Date,await this.stopped,this.setElementValue(this.finalMillisElapsed())}async reset(){await this.stop(),this.element.textContent="0:000"}finalMillisElapsed(){return this.stopTime.getTime()-this.startTime.getTime()}}function g(l,e){if(l==4)return`mine-neighbors-${e.neighborMineCount}`;switch(l){case 0:return"mine";case 1:return"mine-explosion";case 2:return"question-mark";case 3:return"flag-mark";default:throw l}}function p(l){const e="http://www.w3.org/2000/svg",s=document.createElementNS(e,"svg");s.classList.add("sprite");const t=document.createElementNS(e,"use");return t.setAttribute("href",`sprites.svg#${l}`),s.appendChild(t),s}var c=(l=>(l[l.Flag=0]="Flag",l[l.QuestionMark=1]="QuestionMark",l))(c||{});class M{constructor(e,s){this._x=e,this._y=s,this._element=document.createElement("div"),this._element.classList.add("cell"),this._element.dataset.x=e.toString(),this._element.dataset.y=s.toString(),this.contentElement=document.createElement("div"),this.contentElement.classList.add("cell-content"),this._element.appendChild(this.contentElement),this.coverElement=document.createElement("div"),this.coverElement.classList.add("cell-cover"),this.contentElement.appendChild(this.coverElement),this.spriteElement=null}neighborMineCount=0;hasMine=!1;_revealed=!1;_onReveal=()=>{};_mark=null;_onMarkChange=()=>{};_element;contentElement;coverElement;spriteElement;get x(){return this._x}get y(){return this._y}get element(){return this._element}get revealed(){return this._revealed}get mark(){return this._mark}set onReveal(e){this._onReveal=e}set onMarkChange(e){this._onMarkChange=e}addMark(e){switch(this._mark!=e&&this._onMarkChange(this,e),this._mark=e,this.spriteElement?.remove(),e){case 0:{const s=g(3);this.coverElement.appendChild(p(s)),this.spriteElement=this.coverElement.lastElementChild}break;case 1:{const s=g(2);this.coverElement.appendChild(p(s)),this.spriteElement=this.coverElement.lastElementChild}break}}hasMark(){return this._mark!=null}removeMark(){this._mark!=null&&this._onMarkChange(this,null),this._mark=null,this.spriteElement?.remove()}reveal(){this._onReveal(this),this._revealed=!0,this._mark=null}refreshSprite(){if(this.spriteElement?.remove(),this.hasMine){const e=g(0);this.contentElement.appendChild(p(e)),this.spriteElement=this.contentElement.lastElementChild}else if(this.neighborMineCount>0){const e=g(4,{neighborMineCount:this.neighborMineCount});this.contentElement.appendChild(p(e)),this.spriteElement=this.contentElement.lastElementChild}}explode(){if(this.hasMine){this.spriteElement?.remove();const e=g(1);this.contentElement.appendChild(p(e)),this.spriteElement=this.contentElement.lastElementChild}}animateReveal(e=0){this.element.classList.add("revealed"),this.coverElement.animate([{opacity:1,transform:"none"},{offset:.35,opacity:1,transform:"translate(0, -10%)"},{opacity:0,transform:"translate(0, -20%)"}],{fill:"forwards",duration:150,delay:e})}reset(){for(const e of this.coverElement.getAnimations())e.finish();this._revealed&&this.coverElement.animate([{opacity:0,transform:"none"},{opacity:1,transform:"none"}],{fill:"forwards",duration:0}),this.element.classList.remove("revealed"),this.spriteElement?.remove(),this._revealed=!1,this._mark=null,this.hasMine=!1,this.neighborMineCount=0}}var f=(l=>(l[l.Left=0]="Left",l[l.Right=1]="Right",l[l.Both=2]="Both",l))(f||{});const b=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];class y{constructor(e,s){this.width=e,this.height=s,this.element=document.getElementById("game-field"),this._revealedCellCount=0,this.cells=[];for(let i=0;i<this.height;i+=1)for(let h=0;h<this.width;h+=1){const a=new M(h,i);this.cells.push(a),this.element.appendChild(a.element)}const t=[],n=(i,h)=>{const a=this.getCell(i,h);if(!a.hasMark()){a.revealed||(a.element.classList.add("active"),t.push(a));for(const d of this.getNeighbors(a))!d.revealed&&d.mark==null&&(d.element.classList.add("active"),t.push(d))}},r=()=>{for(const i of t)i.element.classList.remove("active");t.length=0};let o=!1,m=!1;this.element.addEventListener("mousedown",i=>{if(i.preventDefault(),i.button==0&&(o=!0),i.button==2&&(m=!0),o&&m&&i.target instanceof HTMLElement&&i.target.classList.contains("cell")){const h=Number.parseInt(i.target.dataset.x),a=Number.parseInt(i.target.dataset.y);n(h,a)}}),this.element.addEventListener("mouseup",i=>{if(i.button!=0&&i.button!=2)return;r();let h=null;if(o&&m?h=f.Both:o?h=f.Left:m&&(h=f.Right),h!=null&&i.target instanceof HTMLElement&&i.target.classList.contains("cell")){const a=Number.parseInt(i.target.dataset.x),d=Number.parseInt(i.target.dataset.y),u=this.getCell(a,d);this._onCellClick(u,h)}o=!1,m=!1}),this.element.addEventListener("mouseover",i=>{if(o&&m&&i.target instanceof HTMLElement&&i.target.classList.contains("cell")){r();const h=Number.parseInt(i.target.dataset.x),a=Number.parseInt(i.target.dataset.y);n(h,a)}}),this.element.addEventListener("mouseleave",i=>{i.target==this.element&&(r(),o=!1,m=!1)}),this.element.addEventListener("contextmenu",i=>{i.preventDefault()})}element;_revealedCellCount;cells;_onCellClick=()=>{};get revealedCellCount(){return this._revealedCellCount}set onCellMarkChange(e){for(const s of this.cells)s.onMarkChange=e}set onCellReveal(e){for(const s of this.cells)s.onReveal=e}set onCellClick(e){this._onCellClick=e}getCell(e,s){const t=this.cells[s*this.width+e];if(t==null)throw new Error("Cell coordinatesa are out of bounds.");return t}cellIndex(e){return e.y*this.width+e.x}*getNeighbors(e){for(const[s,t]of b)e.x+s<0||e.x+s>=this.width||e.y+t<0||e.y+t>=this.height||(yield this.getCell(e.x+s,e.y+t))}fillWithMines(e){if(e>this.width*this.height)throw new Error("Too many mines for the current game field size.");const s=[];for(let t=0;t<this.width*this.height;t+=1)s.push(t);for(let t=0;t<e;t+=1){let n=Math.floor(Math.random()*s.length);const r=this.cells[s[n]];r.hasMine=!0;for(const o of this.getNeighbors(r))o.neighborMineCount+=1;s[n]=s[s.length-1],s.pop()}for(const t of this.cells)t.refreshSprite()}reveal(e,s){const t=this.getCell(e,s);if(!t.revealed)if(t.hasMine||t.neighborMineCount>0)t.reveal(),t.animateReveal(),this._revealedCellCount+=1;else{const n=new Set,r=new Map,o=[t];r.set(this.cellIndex(t),0);let m=0;for(;o.length>0;){const i=o.length;for(let h=0;h<i;h+=1){const a=o.shift();a.reveal(),this._revealedCellCount+=1;const d=r.get(this.cellIndex(a));if(a.animateReveal(Math.min(d,100)*15),a.neighborMineCount==0)for(const u of this.getNeighbors(a)){const C=this.cellIndex(u);!n.has(C)&&!u.revealed&&(n.add(C),r.set(C,m+1),o.push(u))}}m+=1}}}revealAll(){for(const e of this.cells)e.revealed||e.animateReveal(),e.reveal();this._revealedCellCount=this.width*this.height}reset(){for(const e of this.cells)e.reset();this._revealedCellCount=0}}class L{state;width;height;mineCount;minesLeft;minesLeftElement;timer;gameField;constructor(){this.state=0,this.width=16,this.height=16,this.mineCount=30,this.minesLeft=this.mineCount;const e=document.getElementById("difficulty-selection");let s=!1;document.getElementById("difficulty-selection-button").addEventListener("click",()=>{s?(e.style.display="none",s=!1):(e.style.display="block",s=!0)}),this.minesLeftElement=document.getElementById("mines-left"),this.setMinesLeft(this.mineCount),this.timer=new E(document.getElementById("game-timer")),this.gameField=new y(this.width,this.height),this.gameField.fillWithMines(this.mineCount),this.gameField.onCellMarkChange=(t,n)=>{t.mark===c.Flag&&this.setMinesLeft(this.minesLeft+1),n===c.Flag&&this.setMinesLeft(this.minesLeft-1)},this.gameField.onCellReveal=t=>{t.mark===c.Flag&&!t.hasMine&&this.setMinesLeft(this.minesLeft+1),t.mark===null&&t.hasMine&&this.setMinesLeft(this.minesLeft-1)},this.gameField.onCellClick=(t,n)=>{switch(n){case f.Left:this.leftMouseButtonClick(t);break;case f.Right:this.rightMouseButtonClick(t);break;case f.Both:this.bothMouseButtonsClick(t);break}}}setMinesLeft(e){this.minesLeft=e,this.minesLeftElement.textContent=e.toString()}reveal(e){if(this.state===0&&(this.timer.start(),this.state=1),e.hasMine){this.state=3,this.timer.stop(),this.gameField.revealAll();for(const s of this.gameField.cells)s.explode()}else{this.gameField.reveal(e.x,e.y);const s=this.gameField.width*this.gameField.height;this.gameField.revealedCellCount+this.mineCount===s&&(this.state=2,this.timer.stop(),this.gameField.revealAll())}}leftMouseButtonClick(e){if(!e.revealed){if(e.hasMark())return;this.reveal(e)}}rightMouseButtonClick(e){e.revealed||(e.hasMark()?e.mark===c.Flag?e.addMark(c.QuestionMark):e.removeMark():e.addMark(c.Flag))}bothMouseButtonsClick(e){if(!e.revealed)this.leftMouseButtonClick(e);else{let s=0;for(const t of this.gameField.getNeighbors(e))t.mark===c.Flag&&(s+=1);if(s===e.neighborMineCount)for(const t of this.gameField.getNeighbors(e))!t.revealed&&t.mark!==c.Flag&&this.reveal(t)}}reset(){this.gameField.reset(),this.gameField.fillWithMines(this.mineCount),this.timer.reset(),this.state=0,this.setMinesLeft(this.mineCount)}}const w=new L,k=document.getElementById("new-game-button");k.addEventListener("click",()=>{w.reset()});
