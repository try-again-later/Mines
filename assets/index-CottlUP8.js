(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(s){if(s.ep)return;s.ep=!0;const l=t(s);fetch(s.href,l)}})();const M={fps:30};class T{element;fps;startTime=new Date(0);stopTime=new Date(0);shouldStop=!0;stopped=Promise.resolve();constructor(e,t=M){this.element=e,this.element.textContent="0:000",this.fps=t.fps}setElementValue(e){const t=Math.floor(e/1e3),i=`${e%1e3}`.padStart(3,"0");this.element.textContent=`${t}:${i}`}async start(){this.startTime=new Date,this.shouldStop=!1,await this.stopped,this.stopped=new Promise(e=>{let t=0;const i=s=>{if(s-t>1e3/this.fps){t=s;const l=new Date().getTime()-this.startTime.getTime();this.setElementValue(l)}this.shouldStop?e():requestAnimationFrame(i)};requestAnimationFrame(i)})}async stop(){this.shouldStop=!0,this.stopTime=new Date,await this.stopped,this.setElementValue(this.finalMillisElapsed())}async reset(){await this.stop(),this.element.textContent="0:000"}finalMillisElapsed(){return this.stopTime.getTime()-this.startTime.getTime()}}const L="mine",b="mine-explosion",_="question-mark",y="flag-mark",S={1:"mine-neighbors-1",2:"mine-neighbors-2",3:"mine-neighbors-3",4:"mine-neighbors-4",5:"mine-neighbors-5",6:"mine-neighbors-6",7:"mine-neighbors-7",8:"mine-neighbors-8"};function f(m){const e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"svg");t.classList.add("sprite");const i=document.createElementNS(e,"use");return i.setAttribute("href",`sprites.svg#${m}`),t.appendChild(i),t}const h="CELL_FLAG_MARK",g="CELL_QUESTION_MARK";class k{constructor(e,t){this.x=e,this.y=t,this.revealed=!1,this.onReveal=()=>{},this.mark=null,this.onMarkChange=()=>{},this.neighborMineCount=0,this.hasMine=!1,this.element=document.createElement("div"),this.element.classList.add("cell"),this.element.dataset.x=e,this.element.dataset.y=t,this.contentElement=document.createElement("div"),this.contentElement.classList.add("cell-content"),this.element.appendChild(this.contentElement),this.coverElement=document.createElement("div"),this.coverElement.classList.add("cell-cover"),this.contentElement.appendChild(this.coverElement),this.spriteElement=null}addMark(e){switch(this.mark!==e&&this.onMarkChange(this,e),this.mark=e,this.spriteElement?.remove(),e){case h:this.coverElement.appendChild(f(y)),this.spriteElement=this.coverElement.lastElementChild;break;case g:this.coverElement.appendChild(f(_)),this.spriteElement=this.coverElement.lastElementChild;break}}hasMark(){return this.mark!==null}removeMark(){this.mark!==null&&this.onMarkChange(this,null),this.mark=null,this.spriteElement?.remove()}reveal(){this.onReveal(this),this.revealed=!0,this.mark=null}addSprite(){if(this.spriteElement?.remove(),this.hasMine)this.contentElement.appendChild(f(L)),this.spriteElement=this.contentElement.lastElementChild;else if(this.neighborMineCount>0){const e=f(S[this.neighborMineCount]);this.contentElement.appendChild(e),this.spriteElement=this.contentElement.lastElementChild}}animateReveal(e=0){this.element.classList.add("revealed"),this.coverElement.animate([{opacity:1,transform:"none"},{offset:.35,opacity:1,transform:"translate(0, -10%)"},{opacity:0,transform:"translate(0, -20%)"}],{fill:"forwards",duration:150,delay:e})}reset(){for(const e of this.coverElement.getAnimations())e.finish();this.revealed&&this.coverElement.animate([{opacity:0,transform:"none"},{opacity:1,transform:"none"}],{fill:"forwards",duration:0}),this.element.classList.remove("revealed"),this.spriteElement?.remove(),this.revealed=!1,this.mark=null,this.hasMine=!1,this.neighborMineCount=0}}const E="MOUSE_BUTTON_LEFT",p="MOUSE_BUTTON_BOTH",C="MOUSE_BUTTON_RIGHT",w=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];class N{constructor(e,t){this.width=e,this.height=t,this.element=document.getElementById("game-field"),this.revealedCellCount=0,this.cells=[];for(let n=0;n<this.height;n+=1)for(let o=0;o<this.width;o+=1){const a=new k(o,n);this.cells.push(a),this.element.appendChild(a.element)}this.onCellClick=()=>{};const i=[];let s=!1,l=!1;const r=(n,o)=>{const a=this.getCell(n,o);if(!a.hasMark()){a.revealed||(a.element.classList.add("active"),i.push(a));for(const d of this.getNeighbors(a))!d.revealed&&d.mark==null&&(d.element.classList.add("active"),i.push(d))}},c=()=>{for(;i.length>0;)i.pop().element.classList.remove("active")};this.element.addEventListener("mousedown",n=>{if(n.preventDefault(),n.which===1?s=!0:n.which===3&&(l=!0),s&&l&&n.target.classList.contains("cell")){const o=Number.parseInt(n.target.dataset.x),a=Number.parseInt(n.target.dataset.y);r(o,a)}}),this.element.addEventListener("mouseover",n=>{if(s&&l&&n.target.classList.contains("cell")){c();const o=Number.parseInt(n.target.dataset.x),a=Number.parseInt(n.target.dataset.y);r(o,a)}}),this.element.addEventListener("mouseleave",n=>{n.target===this.element&&(c(),s=!1,l=!1)}),this.element.addEventListener("mouseup",n=>{if(n.which!==1&&n.which!==3)return;c();let o=null;if(s&&l?o=p:s?o=E:l&&(o=C),o!==null&&n.target.classList.contains("cell")){const a=Number.parseInt(n.target.dataset.x),d=Number.parseInt(n.target.dataset.y),v=this.getCell(a,d);this.onCellClick(v,o)}s=!1,l=!1}),this.element.addEventListener("contextmenu",n=>{n.preventDefault()})}set onCellMarkChange(e){for(const t of this.cells)t.onMarkChange=e}set onCellReveal(e){for(const t of this.cells)t.onReveal=e}getCell(e,t){return this.cells[t*this.width+e]}*getNeighbors(e){for(const[t,i]of w)e.x+t<0||e.x+t>=this.width||e.y+i<0||e.y+i>=this.height||(yield this.getCell(e.x+t,e.y+i))}fillWithMines(e){const t=[];for(let i=0;i<this.width*this.height;i+=1)t.push(i);for(let i=0;i<e;i+=1){let s=Math.floor(Math.random()*t.length);const l=this.cells[t[s]];l.hasMine=!0;for(const r of this.getNeighbors(l))r.neighborMineCount+=1;t[s]=t[t.length-1],t.pop()}for(const i of this.cells)i.addSprite()}reveal(e,t){const i=this.getCell(e,t);if(!i.revealed)if(i.hasMine||i.neighborMineCount>0)i.reveal(),i.animateReveal(),this.revealedCellCount+=1;else{for(const r of this.cells)delete r.visited,delete r.depth;const s=[i];i.depth=0;let l=0;for(;s.length>0;){const r=s.length;for(let c=0;c<r;c+=1){const n=s.shift();if(n.reveal(),this.revealedCellCount+=1,n.animateReveal(Math.min(n.depth,100)*15),n.neighborMineCount===0)for(const o of this.getNeighbors(n))!o.visited&&!o.revealed&&(o.visited=!0,o.depth=l+1,s.push(o))}l+=1}}}revealAll(){for(const e of this.cells)e.revealed||e.animateReveal(),e.reveal();this.revealedCellCount=this.width*this.height}reset(){for(const e of this.cells)e.reset();this.revealedCellCount=0}}const u="GAME_STATE_START",A="GAME_STATE_IN_PROGRESS",I="GAME_STATE_WIN",R="GAME_STATE_LOSE";class O{constructor(){this.state=u,this.width=16,this.height=16,this.mineCount=30;const e=document.getElementById("difficulty-selection");let t=!1;document.getElementById("difficulty-selection-button").addEventListener("click",()=>{t?(e.style.display="none",t=!1):(e.style.display="block",t=!0)}),this.minesLeftElement=document.getElementById("mines-left"),this.setMinesLeft(this.mineCount);const i=document.getElementById("game-timer");this.timer=new T(i),this.gameField=new N(this.width,this.height),this.gameField.fillWithMines(this.mineCount),this.gameField.onCellMarkChange=(s,l)=>{s.mark===h&&this.setMinesLeft(this.minesLeft+1),l===h&&this.setMinesLeft(this.minesLeft-1)},this.gameField.onCellReveal=s=>{s.mark===h&&!s.hasMine&&this.setMinesLeft(this.minesLeft+1),s.mark===null&&s.hasMine&&this.setMinesLeft(this.minesLeft-1)},this.gameField.onCellClick=(s,l)=>{switch(l){case E:this.leftMouseButtonClick(s);break;case C:this.rightMouseButtonClick(s);break;case p:this.bothMouseButtonsClick(s);break}}}setMinesLeft(e){this.minesLeft=e,this.minesLeftElement.textContent=e}reveal(e){if(this.state===u&&(this.timer.start(),this.state=A),e.hasMine){this.state=R,this.timer.stop(),this.gameField.revealAll();for(const t of this.gameField.cells)t.hasMine&&(t.spriteElement?.remove(),t.contentElement.appendChild(f(b)),t.spriteElement=t.contentElement.lastElementChild)}else{this.gameField.reveal(e.x,e.y);const t=this.gameField.width*this.gameField.height;this.gameField.revealedCellCount+this.mineCount===t&&(this.state=I,this.timer.stop(),this.gameField.revealAll())}}leftMouseButtonClick(e){if(!e.revealed){if(e.hasMark())return;this.reveal(e)}}rightMouseButtonClick(e){e.revealed||(e.hasMark()?e.mark===h?e.addMark(g):e.removeMark():e.addMark(h))}bothMouseButtonsClick(e){if(!e.revealed)this.leftMouseButtonClick(e);else{let t=0;for(const i of this.gameField.getNeighbors(e))i.mark===h&&(t+=1);if(t===e.neighborMineCount)for(const i of this.gameField.getNeighbors(e))!i.revealed&&i.mark!==h&&this.reveal(i)}}reset(){this.gameField.reset(),this.gameField.fillWithMines(this.mineCount),this.timer.reset(),this.state=u,this.setMinesLeft(this.mineCount)}}const F=new O,B=document.getElementById("new-game-button");B.addEventListener("click",()=>{F.reset()});
